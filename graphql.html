<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GraphQL</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
      }

      h1 {
        color: white;
        text-align: center;
        margin-bottom: 30px;
        font-size: 2.5em;
        text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
      }

      .performance-banner {
        background: white;
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        text-align: center;
      }

      .performance-title {
        font-size: 1.2em;
        color: #667eea;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .performance-time {
        font-size: 2.5em;
        font-weight: bold;
        color: #764ba2;
        text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
      }

      .content-wrapper {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 20px;
      }

      .section {
        background: white;
        border-radius: 15px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      }

      .section-title {
        font-size: 1.5em;
        color: #667eea;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 3px solid #667eea;
      }

      .loading {
        text-align: center;
        color: #666;
        padding: 40px;
        font-size: 1.2em;
      }

      .error {
        background: #fee;
        color: #c33;
        padding: 15px;
        border-radius: 8px;
        border-left: 4px solid #c33;
      }

      .rates-grid {
        display: grid;
        gap: 15px;
      }

      .rate-card {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        border-radius: 10px;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      .rate-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .currency-info {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .currency-code {
        font-size: 1.8em;
        font-weight: bold;
        color: #667eea;
        min-width: 60px;
      }

      .currency-name {
        font-size: 0.9em;
        color: #666;
      }

      .rate-value {
        font-size: 1.5em;
        font-weight: bold;
        color: #333;
      }

      .execution-time {
        text-align: right;
        margin-top: 15px;
        color: #888;
        font-size: 0.9em;
      }

      .todos-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .todo-item {
        padding: 15px;
        background: #f8f9fa;
        border-radius: 10px;
        border-left: 4px solid #667eea;
        transition: all 0.2s;
      }

      .todo-item:hover {
        background: #e9ecef;
        transform: translateX(5px);
      }

      .todo-item.completed {
        border-left-color: #28a745;
        opacity: 0.7;
      }

      .todo-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
      }

      .todo-task {
        font-size: 1.1em;
        color: #333;
        font-weight: 500;
      }

      .todo-item.completed .todo-task {
        text-decoration: line-through;
        color: #888;
      }

      .todo-status {
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.85em;
        font-weight: bold;
      }

      .status-completed {
        background: #d4edda;
        color: #155724;
      }

      .status-pending {
        background: #fff3cd;
        color: #856404;
      }

      .todo-meta {
        display: flex;
        justify-content: space-between;
        font-size: 0.85em;
        color: #666;
      }

      /* ë‚ ì”¨ ìŠ¤íƒ€ì¼ */
      .weather-card {
        background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
        border-radius: 15px;
        padding: 20px;
      }

      .weather-main {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .weather-location {
        font-size: 1.8em;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
      }

      .weather-description {
        font-size: 1.1em;
        color: #666;
        text-transform: capitalize;
      }

      .weather-temp {
        font-size: 3.5em;
        font-weight: bold;
        color: #667eea;
      }

      .weather-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin-top: 20px;
      }

      .weather-detail-item {
        background: white;
        padding: 15px;
        border-radius: 10px;
        display: flex;
        flex-direction: column;
        align-items: center;
        transition: transform 0.2s;
      }

      .weather-detail-item:hover {
        transform: translateY(-2px);
      }

      .weather-detail-label {
        font-size: 0.9em;
        color: #666;
        margin-bottom: 5px;
      }

      .weather-detail-value {
        font-size: 1.3em;
        font-weight: bold;
        color: #333;
      }

      .weather-icon {
        font-size: 4em;
      }

      .refresh-button {
        display: block;
        margin: 20px auto;
        padding: 12px 30px;
        background: white;
        color: #667eea;
        border: 2px solid white;
        border-radius: 25px;
        font-size: 1em;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      }

      .refresh-button:hover {
        background: #667eea;
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
      }

      .refresh-button:active {
        transform: translateY(0);
      }

      @media (max-width: 768px) {
        .content-wrapper {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 1.8em;
        }

        .currency-code {
          font-size: 1.5em;
        }

        .rate-value {
          font-size: 1.2em;
        }

        .performance-time {
          font-size: 2em;
        }

        .weather-temp {
          font-size: 2.5em;
        }

        .weather-details {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>

  <body>
    <div class="container">
      <h1>ğŸ“Š í™˜ìœ¨ ì •ë³´ & í•  ì¼ ëª©ë¡ & ë‚ ì”¨</h1>

      <div class="performance-banner" id="performance-banner">
        <div class="performance-title">âš¡ ì „ì²´ í†µì‹  ì‹œê°„</div>
        <div class="performance-time">ì¸¡ì • ì¤‘...</div>
      </div>

      <div class="content-wrapper">
        <div class="section">
          <h2 class="section-title">ğŸ’± ì‹¤ì‹œê°„ í™˜ìœ¨</h2>
          <div id="rates-container">
            <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">âœ… í•  ì¼ ëª©ë¡</h2>
          <div id="todos-container">
            <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>

        <div class="section">
          <h2 class="section-title">ğŸŒ¤ï¸ ì„œìš¸ ë‚ ì”¨</h2>
          <div id="weather-container">
            <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
          </div>
        </div>
      </div>

      <button class="refresh-button" onclick="executeGraphQLQuery()">
        ğŸ”„ ìƒˆë¡œê³ ì¹¨
      </button>
    </div>

    <script>
      const API_CONFIG = {
        endpoint: 'http://localhost:8080/graphql',
        token:
          'eyJhbGciOiJIUzUxMiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJ4ZW5vc2lnbkBuYXZlci5jb20iLCJpYXQiOjE3NjI2MjI0MTcsImV4cCI6MTc2MjYzMTA1N30.rcTwEXu4DjDBPTi2HpcCWYt9GtTUixa0f2h49vSBAnNclXAWDe6vMIvkpdcrwSEmWIVQpZG68XTrbKYNJPvLXw',
        currencyCodes: ['USD', 'JPY', 'EUR'],
        weatherCity: 'Seoul',
        weatherCountry: 'KR',
      };

      const GRAPHQL_QUERY = `
      query GetRatesAndTodosAndWeather($currencyCodes: [String!]!, $city: String!) {
        specificExchangeRates(currencyCodes: $currencyCodes) {
          rates {
            currency
            rate
          }
          executionTimeMs
        },
        getAllTodos {
          id
          task
          completed
          createdAt
        },
        getWeather(city: $city) {
          name
          sys {
            country
          }
          main {
            temp
            feelsLike
            humidity
            pressure
            tempMin
            tempMax
          }
          weather {
            main
            description
            icon
          }
          wind {
            speed
          }
          clouds {
            all
          }
          visibility
        }
      }
    `;

      const CURRENCY_NAMES = {
        USD: 'ë¯¸êµ­ ë‹¬ëŸ¬',
        JPY: 'ì¼ë³¸ ì—”',
        EUR: 'ìœ ë¡œ',
        GBP: 'ì˜êµ­ íŒŒìš´ë“œ',
        CNY: 'ì¤‘êµ­ ìœ„ì•ˆ',
        AUD: 'í˜¸ì£¼ ë‹¬ëŸ¬',
        CAD: 'ìºë‚˜ë‹¤ ë‹¬ëŸ¬',
      };

      const WEATHER_ICONS = {
        Clear: 'â˜€ï¸',
        Clouds: 'â˜ï¸',
        Rain: 'ğŸŒ§ï¸',
        Drizzle: 'ğŸŒ¦ï¸',
        Thunderstorm: 'â›ˆï¸',
        Snow: 'â„ï¸',
        Mist: 'ğŸŒ«ï¸',
        Smoke: 'ğŸ’¨',
        Haze: 'ğŸŒ«ï¸',
        Dust: 'ğŸ’¨',
        Fog: 'ğŸŒ«ï¸',
        Sand: 'ğŸ’¨',
        Ash: 'ğŸŒ‹',
        Squall: 'ğŸ’¨',
        Tornado: 'ğŸŒªï¸',
      };

      function updatePerformanceBanner(networkTime) {
        const banner = document.getElementById('performance-banner');
        const timeElement = banner.querySelector('.performance-time');
        timeElement.textContent = `${networkTime}ms`;
      }

      function renderRates(data, networkTime) {
        const container = document.getElementById('rates-container');

        if (!data || !data.rates || data.rates.length === 0) {
          container.innerHTML =
            '<div class="error">í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        let html = '<div class="rates-grid">';

        data.rates.forEach((rate) => {
          const currencyName = CURRENCY_NAMES[rate.currency] || rate.currency;
          html += `
          <div class="rate-card">
            <div class="currency-info">
              <div class="currency-code">${rate.currency}</div>
              <div class="currency-name">${currencyName}</div>
            </div>
            <div class="rate-value">â‚©${rate.rate.toLocaleString('ko-KR', {
              maximumFractionDigits: 2,
            })}</div>
          </div>
        `;
        });

        html += '</div>';

        if (data.executionTimeMs) {
          html += `<div class="execution-time">â±ï¸ ì„œë²„ ì²˜ë¦¬: ${data.executionTimeMs}ms</div>`;
        }

        container.innerHTML = html;
      }

      function renderTodos(todos) {
        const container = document.getElementById('todos-container');

        if (!todos || todos.length === 0) {
          container.innerHTML =
            '<div class="loading">ë“±ë¡ëœ í•  ì¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        let html = '<div class="todos-list">';

        todos.forEach((todo) => {
          const completedClass = todo.completed ? 'completed' : '';
          const statusClass = todo.completed
            ? 'status-completed'
            : 'status-pending';
          const statusText = todo.completed ? 'ì™„ë£Œ' : 'ì§„í–‰ì¤‘';
          const createdDate = new Date(todo.createdAt).toLocaleString('ko-KR');

          html += `
          <div class="todo-item ${completedClass}">
            <div class="todo-header">
              <div class="todo-task">${todo.task}</div>
              <span class="todo-status ${statusClass}">${statusText}</span>
            </div>
            <div class="todo-meta">
              <span>ID: ${todo.id}</span>
              <span>ìƒì„±ì¼: ${createdDate}</span>
            </div>
          </div>
        `;
        });

        html += '</div>';
        container.innerHTML = html;
      }

      function renderWeather(weather) {
        const container = document.getElementById('weather-container');

        if (!weather) {
          container.innerHTML =
            '<div class="error">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>';
          return;
        }

        const weatherMain =
          weather.weather && weather.weather[0]
            ? weather.weather[0].main
            : 'Clear';
        const weatherDescription =
          weather.weather && weather.weather[0]
            ? weather.weather[0].description
            : '';
        const weatherIcon = WEATHER_ICONS[weatherMain] || 'ğŸŒ¡ï¸';
        const temp = weather.main ? Math.round(weather.main.temp) : 0;
        const feelsLike = weather.main ? Math.round(weather.main.feelsLike) : 0;
        const humidity = weather.main ? weather.main.humidity : 0;
        const windSpeed = weather.wind ? weather.wind.speed : 0;
        const clouds = weather.clouds ? weather.clouds.all : 0;
        const visibility = weather.visibility
          ? (weather.visibility / 1000).toFixed(1)
          : 0;

        const html = `
          <div class="weather-card">
            <div class="weather-main">
              <div>
                <div class="weather-location">${weather.name}, ${
          weather.sys?.country || ''
        }</div>
                <div class="weather-description">${weatherDescription}</div>
              </div>
              <div style="text-align: center;">
                <div class="weather-icon">${weatherIcon}</div>
                <div class="weather-temp">${temp}Â°C</div>
              </div>
            </div>
            
            <div class="weather-details">
              <div class="weather-detail-item">
                <div class="weather-detail-label">ì²´ê° ì˜¨ë„</div>
                <div class="weather-detail-value">${feelsLike}Â°C</div>
              </div>
              <div class="weather-detail-item">
                <div class="weather-detail-label">ìŠµë„</div>
                <div class="weather-detail-value">${humidity}%</div>
              </div>
              <div class="weather-detail-item">
                <div class="weather-detail-label">í’ì†</div>
                <div class="weather-detail-value">${windSpeed} m/s</div>
              </div>
              <div class="weather-detail-item">
                <div class="weather-detail-label">êµ¬ë¦„</div>
                <div class="weather-detail-value">${clouds}%</div>
              </div>
              <div class="weather-detail-item">
                <div class="weather-detail-label">ê°€ì‹œê±°ë¦¬</div>
                <div class="weather-detail-value">${visibility} km</div>
              </div>
              <div class="weather-detail-item">
                <div class="weather-detail-label">ê¸°ì••</div>
                <div class="weather-detail-value">${
                  weather.main?.pressure || 0
                } hPa</div>
              </div>
            </div>
          </div>
        `;

        container.innerHTML = html;
      }

      async function executeGraphQLQuery() {
        const startTime = performance.now();

        try {
          document.getElementById('rates-container').innerHTML =
            '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
          document.getElementById('todos-container').innerHTML =
            '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
          document.getElementById('weather-container').innerHTML =
            '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
          updatePerformanceBanner('ì¸¡ì • ì¤‘...');

          const response = await fetch(API_CONFIG.endpoint, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${API_CONFIG.token}`,
            },
            body: JSON.stringify({
              query: GRAPHQL_QUERY,
              variables: {
                currencyCodes: API_CONFIG.currencyCodes,
                city: API_CONFIG.weatherCity,
                country: API_CONFIG.weatherCountry,
              },
            }),
          });

          const endTime = performance.now();
          const networkTime = Math.round(endTime - startTime);

          updatePerformanceBanner(networkTime);

          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }

          const result = await response.json();

          if (result.errors) {
            throw new Error(result.errors[0].message);
          }

          if (result.data) {
            if (result.data.specificExchangeRates) {
              renderRates(result.data.specificExchangeRates, networkTime);
            }
            if (result.data.getAllTodos) {
              renderTodos(result.data.getAllTodos);
            }
            if (result.data.getWeather) {
              renderWeather(result.data.getWeather);
            }
          }

          console.log('GraphQL Response:', result);
          console.log(`ì „ì²´ í†µì‹  ì‹œê°„: ${networkTime}ms`);
        } catch (error) {
          console.error('Error:', error);
          updatePerformanceBanner('ì˜¤ë¥˜');
          document.getElementById(
            'rates-container'
          ).innerHTML = `<div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
          document.getElementById(
            'todos-container'
          ).innerHTML = `<div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
          document.getElementById(
            'weather-container'
          ).innerHTML = `<div class="error">âŒ ì˜¤ë¥˜: ${error.message}</div>`;
        }
      }

      window.addEventListener('DOMContentLoaded', executeGraphQLQuery);
    </script>
  </body>
</html>
